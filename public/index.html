<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>BK Scrape</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
			font-family: Arial, Helvetica, sans-serif;
		}

		.text {
			margin: 10px;
			text-align: center;
		}

		.loader {
			border: 16px solid #f3f3f3;
			border-radius: 50%;
			border-top: 16px solid #3498db;
			width: 120px;
			height: 120px;
			animation: spin 2s linear infinite;
			position: absolute;
			left: 50%;
			top: 50%;
			margin: -60px 0 0 -60px;
		}

		@keyframes spin {
			0% {
				transform: rotate(0deg);
			}

			100% {
				transform: rotate(360deg);
			}
		}
	</style>
</head>
<body>
	<p class="text">please wait... your file should download automatically. if it does not download after 1 minute,
		refresh
	</p>
	<!-- Loading Spinner -->
	<div class="loader" id="loader"></div>
	<script>
		// Start the fetch process as soon as the page loads
		window.onload = function () {
			fetch('/api/get-data')
				.then(response => {
					if (response.ok) {
						response.blob().then(blob => {
							// Create a link element, use it to download the file, and then click it
							const url = window.URL.createObjectURL(blob);
							const a = document.createElement('a');
							a.style.display = 'none';
							a.href = url;
							// the filename you want
							a.download = 'data.zip';
							document.body.appendChild(a);
							a.click();
							window.URL.revokeObjectURL(url);
							alert('Your file has started downloading.');
						});
					} else {
						alert('There was a problem with the request.');
					}
				})
				.catch(error => {
					alert('An error occurred while fetching the data.');
					console.error('Fetch error:', error);
				})
				.finally(() => {
					// Hide the loader when the fetch is complete
					document.getElementById('loader').style.display = 'none';
				});

			// Set a timeout to alert the user if the download does not start
			setTimeout(() => {
				const loader = document.getElementById('loader');
				if (loader.style.display !== 'none') {
					alert('The download is taking longer than expected. Please refresh.');
					loader.style.display = 'none';
				}
			}, 60000); // 60 seconds
		};
	</script>
</body>
</html>